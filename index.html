import React, { useState, useEffect } from 'react';

const TravelMatrixDemo = () => {
  const [currentStep, setCurrentStep] = useState(0);
  const [demoEmm, setDemoEmm] = useState({ d: 1.0, mu: 1.0, s: 1.0, tau: 1.0, k: 1.0 });
  const [isAnimating, setIsAnimating] = useState(false);

  // Demo journal entries showing different emotional states
  const demoEntries = [
    {
      id: 1,
      date: '2024-09-01',
      title: 'Peaceful Morning',
      score: 85,
      tags: ['calm', 'grateful', 'grounded'],
      body: 'Started the day with meditation. Feeling centered and ready for whatever comes.',
      emm: { d: 0.9, mu: 1.4, s: 0.7, tau: 1.3, k: 1.2 }
    },
    {
      id: 2,
      date: '2024-09-02', 
      title: 'Adventure Calling',
      score: 92,
      tags: ['excited', 'curious', 'brave'],
      body: 'Booked that hiking trip! Heart racing with anticipation. Time to explore.',
      emm: { d: 1.4, mu: 1.1, s: 1.6, tau: 0.8, k: 1.3 }
    },
    {
      id: 3,
      date: '2024-09-03',
      title: 'Overwhelming Day', 
      score: 45,
      tags: ['overwhelmed', 'tired', 'anxious'],
      body: 'Too many decisions, too little time. Need to slow down and breathe.',
      emm: { d: 0.8, mu: 0.6, s: 0.5, tau: 0.7, k: 0.9 }
    },
    {
      id: 4,
      date: '2024-09-04',
      title: 'Deep Connections',
      score: 88,
      tags: ['connected', 'hopeful', 'tender'],
      body: 'Long conversation with old friend. Reminded me what really matters.',
      emm: { d: 1.0, mu: 1.7, s: 0.9, tau: 1.2, k: 1.4 }
    }
  ];

  const steps = [
    {
      title: "1. Daily Journal Reflection",
      description: "You write in your Journey Journal each evening - just 2 minutes capturing your day's emotions, experiences, and insights.",
      component: "journal"
    },
    {
      title: "2. Intelligent EMM Translation", 
      description: "The system analyzes your tags, mood score, and reflections to calculate your unique EMM signature for that day.",
      component: "analysis"
    },
    {
      title: "3. Living Matrix Visualization",
      description: "Your EMM values become a living, breathing geometric art piece. Each value controls different aspects of the animation.",
      component: "matrix"
    },
    {
      title: "4. Personalized Travel Insights",
      description: "Based on your EMM patterns over time, get AI-powered suggestions for destinations and experiences that match your inner journey.",
      component: "insights"
    }
  ];

  const currentEntry = demoEntries[currentStep % demoEntries.length];

  // Update EMM when step changes
  useEffect(() => {
    if (currentEntry) {
      setIsAnimating(true);
      setTimeout(() => {
        setDemoEmm(currentEntry.emm);
        setIsAnimating(false);
      }, 300);
    }
  }, [currentStep, currentEntry]);

  // Update CSS variables for animation
  useEffect(() => {
    const root = document.documentElement;
    Object.entries(demoEmm).forEach(([key, value]) => {
      root.style.setProperty(`--demo-${key}`, value.toString());
    });
  }, [demoEmm]);

  const nextStep = () => {
    setCurrentStep((prev) => (prev + 1) % steps.length);
  };

  const prevStep = () => {
    setCurrentStep((prev) => (prev - 1 + steps.length) % steps.length);
  };

  const fmt = (x) => Number(x).toFixed(2);

  const renderJournalStep = () => (
    <div className="bg-white rounded-xl p-6 border border-gray-200">
      <div className="flex items-center gap-3 mb-4">
        <div className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
          üìñ
        </div>
        <h3 className="text-lg font-semibold">Today's Journal Entry</h3>
      </div>
      
      <div className="space-y-4">
        <div className="flex gap-4">
          <div>
            <label className="text-sm text-gray-600">Date</label>
            <div className="font-medium">{currentEntry.date}</div>
          </div>
          <div>
            <label className="text-sm text-gray-600">Mood Score</label>
            <div className="font-medium">{currentEntry.score}/100</div>
          </div>
        </div>
        
        <div>
          <label className="text-sm text-gray-600">Title</label>
          <div className="font-medium text-lg">{currentEntry.title}</div>
        </div>
        
        <div>
          <label className="text-sm text-gray-600">Feelings</label>
          <div className="flex gap-2 mt-1">
            {currentEntry.tags.map((tag, index) => (
              <span key={index} className="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">
                {tag}
              </span>
            ))}
          </div>
        </div>
        
        <div>
          <label className="text-sm text-gray-600">Reflection</label>
          <div className="text-gray-800 leading-relaxed">{currentEntry.body}</div>
        </div>
      </div>
    </div>
  );

  const renderAnalysisStep = () => (
    <div className="bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl p-6 border border-purple-200">
      <div className="flex items-center gap-3 mb-4">
        <div className="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
          üß†
        </div>
        <h3 className="text-lg font-semibold">EMM Analysis</h3>
      </div>
      
      <div className="space-y-4">
        <p className="text-gray-700">
          Your journal entry is analyzed to extract your Existential Motion Metric (EMM) signature:
        </p>
        
        <div className="grid grid-cols-1 md:grid-cols-5 gap-4">
          {Object.entries(currentEntry.emm).map(([key, value]) => (
            <div key={key} className="text-center p-3 bg-white rounded-lg border">
              <div className="text-2xl font-mono font-bold text-purple-600">
                {fmt(value)}
              </div>
              <div className="text-sm font-medium text-gray-600">
                {key === 'mu' ? 'Œº (meaning)' : 
                 key === 'tau' ? 'œÑ (patience)' :
                 key === 'd' ? 'd (distance)' :
                 key === 's' ? 's (speed)' : 'k (intention)'}
              </div>
              <div className="text-xs text-gray-500 mt-1">
                {key === 'd' ? 'Adventure vs Safety' :
                 key === 'mu' ? 'Connection & Purpose' :
                 key === 's' ? 'Energy & Activity' :
                 key === 'tau' ? 'Calm vs Stress' : 'Direction & Focus'}
              </div>
            </div>
          ))}
        </div>
        
        <div className="bg-white rounded-lg p-4 border border-purple-200">
          <h4 className="font-medium mb-2">How it works:</h4>
          <ul className="text-sm text-gray-600 space-y-1">
            <li>‚Ä¢ <strong>Tags like "excited, curious"</strong> increase Distance & Speed</li>
            <li>‚Ä¢ <strong>High mood scores</strong> boost Meaning & Intention</li>
            <li>‚Ä¢ <strong>"Calm, grounded" feelings</strong> enhance Patience</li>
            <li>‚Ä¢ <strong>Stress indicators</strong> lower multiple dimensions</li>
          </ul>
        </div>
      </div>
    </div>
  );

  const renderMatrixStep = () => (
    <div className="bg-gray-50 rounded-xl p-6 border border-gray-200">
      <div className="flex items-center gap-3 mb-4">
        <div className="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
          ‚ú®
        </div>
        <h3 className="text-lg font-semibold">Living Matrix Visualization</h3>
      </div>
      
      <div className="space-y-4">
        <p className="text-gray-700">
          Your EMM values control every aspect of this living geometric art:
        </p>
        
        {/* SVG Matrix */}
        <div className="bg-white rounded-lg p-4 border">
          <svg 
            className="w-full h-auto matrix-demo"
            viewBox="0 0 400 400" 
            style={{
              '--demo-d': demoEmm.d,
              '--demo-mu': demoEmm.mu, 
              '--demo-s': demoEmm.s,
              '--demo-tau': demoEmm.tau,
              '--demo-k': demoEmm.k
            } as React.CSSProperties}
          >
            {/* Background */}
            <rect width="400" height="400" fill="#f8fafc" />
            
            {/* Outer breathing field */}
            <g className="demo-outer">
              <circle 
                cx="200" 
                cy="200" 
                r="180" 
                fill="none" 
                stroke="#326FB7" 
                strokeWidth="2"
                opacity="0.8"
              />
            </g>
            
            {/* Rotating petals */}
            <g className="demo-petals-cw" opacity="0.6">
              {[0, 60, 120].map(angle => (
                <g key={angle} transform={`rotate(${angle} 200 200)`}>
                  <circle 
                    cx="200" 
                    cy="200" 
                    r="120" 
                    fill="none" 
                    stroke="#aeb4b9" 
                    strokeWidth="1.5"
                  />
                </g>
              ))}
            </g>
            
            {/* Orbits with travelers */}
            <g className="demo-orbit-fast">
              <ellipse 
                cx="200" 
                cy="200" 
                rx="160" 
                ry="100" 
                fill="none" 
                stroke="#111" 
                strokeWidth="2.5" 
                opacity="0.9"
              />
              <circle cx="360" cy="200" r="6" fill="#111" className="demo-traveller"/>
            </g>
            
            <g className="demo-orbit-slow">
              <ellipse 
                cx="200" 
                cy="200" 
                rx="80" 
                ry="140" 
                fill="none" 
                stroke="#666" 
                strokeWidth="2"
              />
              <circle cx="280" cy="200" r="5" fill="#666" className="demo-traveller"/>
            </g>
            
            {/* Pulsing core */}
            <g className="demo-core-pulse">
              <circle cx="200" cy="200" r="30" fill="#222" opacity="0.85"/>
              <circle cx="200" cy="200" r="45" fill="none" stroke="#326FB7" strokeWidth="2" opacity="0.9"/>
            </g>
          </svg>
        </div>
        
        {/* Current EMM Display */}
        <div className="grid grid-cols-5 gap-3 text-center">
          {Object.entries(demoEmm).map(([key, value]) => (
            <div key={key} className="bg-white rounded-lg p-3 border">
              <div className="text-lg font-mono font-bold text-blue-600">
                {fmt(value)}
              </div>
              <div className="text-xs text-gray-500">
                {key === 'mu' ? 'Œº' : key === 'tau' ? 'œÑ' : key}
              </div>
            </div>
          ))}
        </div>
        
        <div className="bg-blue-50 rounded-lg p-4 border border-blue-200">
          <h4 className="font-medium mb-2 text-blue-800">Live Animation Effects:</h4>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-blue-700">
            <div>‚Ä¢ <strong>Distance (d)</strong>: Outer field breathing</div>
            <div>‚Ä¢ <strong>Meaning (Œº)</strong>: Traveler glow intensity</div>
            <div>‚Ä¢ <strong>Speed (s)</strong>: Rotation rates</div>
            <div>‚Ä¢ <strong>Patience (œÑ)</strong>: Animation smoothness</div>
            <div>‚Ä¢ <strong>Intention (k)</strong>: Core pulse strength</div>
          </div>
        </div>
      </div>
    </div>
  );

  const renderInsightsStep = () => {
    const getTravelSuggestion = (emm) => {
      if (emm.mu > 1.3 && emm.tau > 1.1) {
        return {
          type: "Contemplative Retreat",
          reason: "High meaning + patience suggests you value deep, reflective experiences",
          destinations: ["Dharamshala, India", "Sedona, Arizona", "Kyoto, Japan"],
          activities: ["Meditation retreats", "Temple visits", "Nature walks"]
        };
      } else if (emm.d > 1.2 && emm.s > 1.3) {
        return {
          type: "Adventure Expedition", 
          reason: "High distance + speed indicates appetite for active exploration",
          destinations: ["Patagonia", "Nepal Himalayas", "New Zealand"],
          activities: ["Trekking", "Rock climbing", "Extreme sports"]
        };
      } else if (emm.mu < 0.8 && emm.tau < 0.8) {
        return {
          type: "Restorative Escape",
          reason: "Lower meaning + patience suggests need for gentle restoration",
          destinations: ["Tuscany", "Bali", "Costa Rica"], 
          activities: ["Spa retreats", "Beach time", "Gentle yoga"]
        };
      } else {
        return {
          type: "Cultural Immersion",
          reason: "Balanced profile suggests readiness for rich cultural experiences",
          destinations: ["Morocco", "Peru", "Vietnam"],
          activities: ["Local homestays", "Cooking classes", "Historical tours"]
        };
      }
    };

    const suggestion = getTravelSuggestion(currentEntry.emm);

    return (
      <div className="bg-gradient-to-br from-green-50 to-teal-50 rounded-xl p-6 border border-green-200">
        <div className="flex items-center gap-3 mb-4">
          <div className="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
            ‚úàÔ∏è
          </div>
          <h3 className="text-lg font-semibold">AI Travel Insights</h3>
        </div>
        
        <div className="space-y-4">
          <p className="text-gray-700">
            Based on your EMM pattern, here's what the AI recommends:
          </p>
          
          <div className="bg-white rounded-lg p-4 border border-green-200">
            <div className="flex items-center gap-2 mb-3">
              <span className="text-2xl">üéØ</span>
              <h4 className="text-lg font-semibold text-green-800">{suggestion.type}</h4>
            </div>
            
            <p className="text-gray-700 mb-4">{suggestion.reason}</p>
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <h5 className="font-medium text-green-800 mb-2">Recommended Destinations:</h5>
                <ul className="space-y-1">
                  {suggestion.destinations.map((dest, index) => (
                    <li key={index} className="text-sm text-gray-600 flex items-center gap-2">
                      <span className="w-1.5 h-1.5 bg-green-400 rounded-full"></span>
                      {dest}
                    </li>
                  ))}
                </ul>
              </div>
              
              <div>
                <h5 className="font-medium text-green-800 mb-2">Suggested Activities:</h5>
                <ul className="space-y-1">
                  {suggestion.activities.map((activity, index) => (
                    <li key={index} className="text-sm text-gray-600 flex items-center gap-2">
                      <span className="w-1.5 h-1.5 bg-green-400 rounded-full"></span>
                      {activity}
                    </li>
                  ))}
                </ul>
              </div>
            </div>
          </div>
          
          <div className="bg-teal-50 rounded-lg p-4 border border-teal-200">
            <h4 className="font-medium mb-2 text-teal-800">How it works:</h4>
            <p className="text-sm text-teal-700">
              The AI analyzes patterns across weeks/months of your EMM data to identify what types of 
              experiences align with your authentic emotional needs and growth trajectory.
            </p>
          </div>
        </div>
      </div>
    );
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
      <div className="max-w-6xl mx-auto">
        
        {/* Header */}
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold text-gray-900 mb-2">
            Travel Matrix: Interactive Demo
          </h1>
          <p className="text-gray-600 max-w-2xl mx-auto">
            See how your daily journal reflections transform into personalized travel insights through 
            beautiful, living mathematical visualizations.
          </p>
        </div>

        {/* Progress Indicator */}
        <div className="flex justify-center mb-8">
          <div className="flex items-center gap-2">
            {steps.map((_, index) => (
              <React.Fragment key={index}>
                <div className={`w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium ${
                  index === currentStep 
                    ? 'bg-blue-600 text-white' 
                    : index < currentStep
                      ? 'bg-green-500 text-white'
                      : 'bg-gray-200 text-gray-600'
                }`}>
                  {index + 1}
                </div>
                {index < steps.length - 1 && (
                  <div className={`w-16 h-0.5 ${
                    index < currentStep ? 'bg-green-500' : 'bg-gray-200'
                  }`}></div>
                )}
              </React.Fragment>
            ))}
          </div>
        </div>

        {/* Current Step */}
        <div className="mb-8">
          <div className="text-center mb-6">
            <h2 className="text-2xl font-semibold text-gray-900 mb-2">
              {steps[currentStep].title}
            </h2>
            <p className="text-gray-600 max-w-3xl mx-auto">
              {steps[currentStep].description}
            </p>
          </div>

          {/* Step Content */}
          <div className={`transition-all duration-500 ${isAnimating ? 'opacity-50 scale-95' : 'opacity-100 scale-100'}`}>
            {steps[currentStep].component === 'journal' && renderJournalStep()}
            {steps[currentStep].component === 'analysis' && renderAnalysisStep()}
            {steps[currentStep].component === 'matrix' && renderMatrixStep()}
            {steps[currentStep].component === 'insights' && renderInsightsStep()}
          </div>
        </div>

        {/* Navigation */}
        <div className="flex justify-center gap-4 mb-8">
          <button 
            onClick={prevStep}
            className="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
          >
            ‚Üê Previous
          </button>
          <button 
            onClick={nextStep}
            className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            Next ‚Üí
          </button>
        </div>

        {/* Sample Data Indicator */}
        <div className="text-center">
          <div className="inline-flex items-center gap-2 px-4 py-2 bg-yellow-100 text-yellow-800 rounded-full text-sm">
            üìä Currently showing: {currentEntry.title} ({currentEntry.date})
          </div>
          <p className="text-gray-500 text-sm mt-2">
            This demo cycles through 4 different emotional states to show how the Matrix responds to your inner journey
          </p>
        </div>
      </div>

      {/* CSS Animations */}
      <style jsx>{`
        .demo-outer {
          transform-origin: 50% 50%;
          animation: demo-breathe calc(4s / var(--demo-tau)) ease-in-out infinite alternate;
        }
        
        .demo-petals-cw {
          transform-origin: 50% 50%;
          animation: demo-rotate calc(20s / var(--demo-s)) linear infinite;
        }
        
        .demo-orbit-fast {
          transform-origin: 50% 50%;
          animation: demo-rotate calc(10s / var(--demo-s)) linear infinite;
        }
        
        .demo-orbit-slow {
          transform-origin: 50% 50%;
          animation: demo-rotate calc(15s / var(--demo-s)) linear infinite reverse;
        }
        
        .demo-core-pulse {
          transform-origin: 50% 50%;
          animation: demo-pulse calc(2s / var(--demo-k)) ease-in-out infinite alternate;
        }
        
        .demo-traveller {
          filter: drop-shadow(0 0 calc(2px * var(--demo-mu)) rgba(50, 111, 183, calc(0.4 * var(--demo-mu))));
        }

        @keyframes demo-breathe {
          from { transform: scale(calc(0.95 * var(--demo-d))); }
          to { transform: scale(calc(1.05 * var(--demo-d))); }
        }
        
        @keyframes demo-rotate {
          to { transform: rotate(360deg); }
        }
        
        @keyframes demo-pulse {
          from { transform: scale(calc(0.9 + (var(--demo-k) - 1) * 0.1)); }
          to { transform: scale(calc(1.1 + (var(--demo-k) - 1) * 0.2)); }
        }
      `}</style>
    </div>
  );
};

export default TravelMatrixDemo;
