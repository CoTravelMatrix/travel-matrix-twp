<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>My Journey Journal — Travel With Purpose</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root{ --blue:#326FB7; --ink:#111; --paper:#F6F7F8; --line:#E7EAEE; }
  html,body{margin:0;background:var(--paper);font:11pt Calibri, Arial, sans-serif;color:var(--ink)}
  .wrap{max-width:980px;margin:28px auto;padding:0 14px}
  .card{background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.07);margin-bottom:16px}
  .pad{padding:14px}
  h1{font-size:18px;margin:0 0 6px}
  h2{font-size:16px;margin:10px 0 6px}
  .small{font-size:12px;color:#47515a}
  .muted{color:#6b7580}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .col{flex:1 1 260px}
  input[type=text], input[type=date], textarea, select{
    width:100%;padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:#fff
  }
  textarea{min-height:96px}
  .btn{cursor:pointer;padding:8px 12px;border:1px solid var(--line);border-radius:10px;background:#fff}
  .btn:hover{box-shadow:0 2px 6px rgba(0,0,0,.08)}
  .btn.blue{border-color:var(--blue);color:#fff;background:var(--blue)}
  .tag{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;margin:2px 4px;font-size:12px;cursor:pointer}
  .tag.active{border-color:var(--blue);color:#fff;background:var(--blue)}
  .right{display:flex;justify-content:flex-end;gap:8px}
  .list{border-top:1px dashed var(--line);margin-top:10px;padding-top:10px}
  .entry{border:1px solid var(--line);border-radius:12px;padding:10px;margin-bottom:10px}
  .pill{display:inline-block;background:#eef4fb;color:#204c7a;border-radius:999px;padding:2px 8px;font-size:11px;margin-right:6px}
  .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
  @media (max-width:720px){.grid{grid-template-columns:1fr}}
  .hint{font-size:11px;color:#667;line-height:1.4}
  .hr{height:1px;background:var(--line);margin:10px 0}
</style>
</head>
<body>
<div class="wrap">

  <!-- Header -->
  <div class="card pad">
    <h1>My Journey Journal</h1>
    <div class="small">
      Travel with Purpose begins at Zero—calm the chaos, centre the “you”, and move piece-by-piece from puzzle to picture. 
      Use the prompts below to reflect, then log an entry. Your North Star steadies the course; the tree grows with each note. 
    </div>
  </div>

  <!-- North Star / Mental Compass -->
  <div class="card pad" id="compass">
    <h2>North Star — Mental Compass</h2>
    <div class="row">
      <div class="col">
        <label class="small">Today’s North Star (one line)</label>
        <input type="text" id="northStar" placeholder="What quietly matters most today?">
      </div>
      <div class="col">
        <label class="small">State at Zero (one word)</label>
        <input type="text" id="zeroWord" placeholder="Calm / Curious / Patient …">
      </div>
    </div>
    <div class="hr"></div>
    <div class="grid">
      <div>
        <label class="small">5 Components check-in (quick notes)</label>
        <textarea id="fiveNotes" placeholder="Where? When? How? How much? Who?"></textarea>
        <div class="hint muted">The 5 components frame the plan; YOU is the living centre. Align them lightly, not rigidly.</div>
      </div>
      <div>
        <label class="small">Ikigai lens (what I love / am good at / world needs / can be paid for)</label>
        <textarea id="ikigai" placeholder="One sentence per quadrant, if helpful."></textarea>
        <div class="hint muted">A glance, not an exam. We’re seeking direction, not judgement.</div>
      </div>
    </div>
  </div>

  <!-- Two-Minute Evening Pager -->
  <div class="card pad">
    <h2>Two-Minute Evening Pager</h2>
    <div class="grid">
      <div>
        <label class="small">What moved today? (1–2 lines)</label>
        <textarea id="moved" placeholder="The tiny motion that mattered…"></textarea>
      </div>
      <div>
        <label class="small">One win, one lesson</label>
        <textarea id="winLesson" placeholder="Win → …  Lesson → …"></textarea>
      </div>
      <div>
        <label class="small">One kindness given</label>
        <textarea id="kindness" placeholder="To self or others."></textarea>
      </div>
      <div>
        <label class="small">Tomorrow’s micro-move</label>
        <textarea id="micromove" placeholder="So small it’s almost silly."></textarea>
      </div>
    </div>
  </div>

  <!-- Random Hearts (prompt picker) -->
  <div class="card pad">
    <h2>Random Hearts — Prompt Picker</h2>
    <div class="row">
      <button class="btn" data-prompt="purpose">North Star: Purpose</button>
      <button class="btn" data-prompt="excitement">Fast Orbit: Excitement</button>
      <button class="btn" data-prompt="connection">Medium Orbit: Connection</button>
      <button class="btn" data-prompt="reflection">Slow Orbit: Reflection</button>
    </div>
    <div id="promptBox" class="small muted" style="margin-top:8px"></div>
  </div>

  <!-- Emotions Glossary (tags that drive the score) -->
  <div class="card pad">
    <h2>Feelings & Signals — Tag what’s present</h2>
    <div class="hint muted" style="margin-bottom:6px">
      Tap a few words below (edit list anytime). Tags don’t define you; they reveal conditions around the journey.
    </div>
    <div id="tags" style="margin-bottom:8px"></div>
    <div class="row">
      <div class="col">
        <textarea id="glossary" class="small" style="min-height:70px"
          placeholder="Edit feelings list here, comma-separated…">Calm, Curious, Excited, Grateful, Connected, Grounded, Overwhelmed, Tired, Anxious, Disappointed, Lonely, Hopeful, Brave, Tender, Playful</textarea>
      </div>
      <div class="col right">
        <button class="btn" id="applyGlossary">Update Words</button>
      </div>
    </div>
  </div>

  <!-- Journal Entry -->
  <div class="card pad">
    <h2>Write Today’s Entry</h2>
    <div class="row">
      <div class="col"><label class="small">Date</label><input type="date" id="date"></div>
      <div class="col"><label class="small">Title</label><input type="text" id="title" placeholder="Give the page a name"></div>
    </div>
    <label class="small" style="margin-top:8px;display:block">Your story</label>
    <textarea id="body" placeholder="What’s the picture the puzzle is pointing to? Where’s the seed pushing up?"></textarea>
    <div class="row" style="align-items:center;margin-top:8px">
      <div class="col small muted">Selected tags: <span id="chosen" class="pill"></span></div>
      <div class="col right">
        <button class="btn" id="scoreBtn">Score Preview</button>
        <button class="btn blue" id="saveBtn">Save Entry</button>
      </div>
    </div>
    <div id="scoreLine" class="small muted" style="margin-top:6px"></div>
  </div>

  <!-- Entries List + Export -->
  <div class="card pad">
    <div class="row" style="align-items:center">
      <h2 style="flex:1">Your Pages</h2>
      <div class="right">
        <button class="btn" id="exportCSV">Export CSV</button>
        <button class="btn" id="clearAll">Clear All (local)</button>
      </div>
    </div>
    <div class="list" id="entries"></div>
    <div class="hint muted">Stored on your device. Export to feed the Matrix Timeline later.</div>
  </div>

  <div class="small muted" style="text-align:center;margin:18px 0">
    © CoTravel — Travel with Purpose. Journal structure inspired by your Travel Matrix (puzzle + tree, Zero→Flow, 5 components, Ikigai, Journey Journaling). 
  </div>

</div>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  const todayISO = ()=> new Date().toISOString().slice(0,10);
  $('date').value = todayISO();

  // Random Hearts (your tone)
  const PROMPTS = {
    purpose: 'North Star: What quietly matters most today? Name the smallest move that honours it.',
    excitement: 'Excitement: Where did curiosity spark? How could you keep a gentle flame without burning out?',
    connection: 'Connection: Who or what felt like good company? What condition helped it happen?',
    reflection: 'Reflection: What needs grace or fallow time? Where can you pause without quitting?'
  };
  document.querySelectorAll('[data-prompt]').forEach(b=>{
    b.addEventListener('click', ()=>{ $('promptBox').textContent = PROMPTS[b.dataset.prompt]; });
  });

  // Glossary → clickable tags
  function renderTags(){
    const box = $('tags'); box.innerHTML = '';
    const words = $('glossary').value.split(',').map(s=>s.trim()).filter(Boolean);
    words.forEach(w=>{
      const span = document.createElement('span');
      span.className = 'tag'; span.textContent = w;
      span.addEventListener('click', ()=>{ span.classList.toggle('active'); renderChosen(); });
      box.appendChild(span);
    });
  }
  function renderChosen(){
    const chosen = [...document.querySelectorAll('#tags .tag.active')].map(el=>el.textContent);
    $('chosen').textContent = chosen.join(' · ');
  }
  $('applyGlossary').addEventListener('click', renderTags);
  renderTags();

  // Micro score (transparent, not a verdict)
  function computeScore(){
    const tags = [...document.querySelectorAll('#tags .tag.active')].map(el=>el.textContent.toLowerCase());
    const positives = ['calm','curious','grateful','connected','grounded','hopeful','brave','tender','playful','excited'];
    const negatives = ['overwhelmed','tired','anxious','disappointed','lonely'];
    let pos = tags.filter(t=>positives.includes(t)).length;
    let neg = tags.filter(t=>negatives.includes(t)).length;
    const base = 50 + (pos*8) - (neg*8);
    const clamp = Math.max(0, Math.min(100, base));
    return Math.round(clamp);
  }
  $('scoreBtn').addEventListener('click', ()=>{
    $('scoreLine').textContent = 'Signal score (0–100): ' + computeScore() + ' — a weather report, not a judgement.';
  });

  // Save entry (localStorage)
  function loadAll(){ try{return JSON.parse(localStorage.getItem('twp.journal.v1'))||[]}catch(e){return[];} }
  function saveAll(arr){ localStorage.setItem('twp.journal.v1', JSON.stringify(arr)); }
  function clearForm(){
    $('title').value=''; $('body').value=''; $('moved').value=''; $('winLesson').value=''; $('kindness').value=''; $('micromove').value='';
    document.querySelectorAll('#tags .tag.active').forEach(el=>el.classList.remove('active')); renderChosen(); $('scoreLine').textContent='';
  }
  function renderList(){
    const box = $('entries'); box.innerHTML='';
    const all = loadAll().sort((a,b)=>b.date.localeCompare(a.date));
    all.forEach((e,i)=>{
      const div = document.createElement('div'); div.className='entry';
      div.innerHTML = `
        <div class="row" style="align-items:center">
          <div class="small muted" style="flex:1">${e.date} — <strong>${escapeHtml(e.title||'Untitled')}</strong></div>
          <div class="pill">Score ${e.score}</div>
          <button class="btn" data-del="${e.id}">Delete</button>
        </div>
        <div class="small" style="margin:6px 0">${e.tags.map(t=>`<span class="pill">${escapeHtml(t)}</span>`).join(' ')}</div>
        <div class="small muted">${escapeHtml(e.northStar||'')}</div>
        <div class="hr"></div>
        <div>${nl2br(escapeHtml(e.body||''))}</div>
        <div class="hr"></div>
        <div class="grid small muted">
          <div><strong>Moved:</strong> ${nl2br(escapeHtml(e.moved||''))}</div>
          <div><strong>Win/Lesson:</strong> ${nl2br(escapeHtml(e.winLesson||''))}</div>
          <div><strong>Kindness:</strong> ${nl2br(escapeHtml(e.kindness||''))}</div>
          <div><strong>Tomorrow’s micro-move:</strong> ${nl2br(escapeHtml(e.micromove||''))}</div>
        </div>
      `;
      box.appendChild(div);
    });
    box.querySelectorAll('[data-del]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.getAttribute('data-del');
        const next = loadAll().filter(e=>e.id!==id); saveAll(next); renderList();
      });
    });
  }
  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
  function nl2br(s){ return (s||'').replace(/\n/g,'<br>'); }
  function uuid(){ return 'id-'+Math.random().toString(36).slice(2,10); }

  $('saveBtn').addEventListener('click', ()=>{
    const tags = [...document.querySelectorAll('#tags .tag.active')].map(el=>el.textContent);
    const entry = {
      id: uuid(),
      date: $('date').value || todayISO(),
      title: $('title').value.trim(),
      body: $('body').value,
      tags,
      score: computeScore(),
      northStar: $('northStar').value,
      zeroWord: $('zeroWord').value,
      fiveNotes: $('fiveNotes').value,
      ikigai: $('ikigai').value,
      moved: $('moved').value,
      winLesson: $('winLesson').value,
      kindness: $('kindness').value,
      micromove: $('micromove').value
    };
    const all = loadAll(); all.push(entry); saveAll(all); renderList(); clearForm();
  });

  // Export CSV (ready for your Timeline)
  $('exportCSV').addEventListener('click', ()=>{
    const rows = loadAll();
    const header = ['date','title','score','tags','northStar','zeroWord','fiveNotes','ikigai','moved','winLesson','kindness','micromove','body'];
    const csv = [header.join(',')].concat(rows.map(r=>{
      return header.map(k=>csvCell(Array.isArray(r[k])? r[k].join('|') : (r[k]||''))).join(',');
    })).join('\n');
    download('twp_journal.csv', csv, 'text/csv');
  });

  function csvCell(s){ s = String(s).replace(/"/g,'""'); return `"${s}"`; }
  function download(filename, content, mime){
    const blob = new Blob([content],{type: mime || 'text/plain'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename; a.click();
    setTimeout(()=>URL.revokeObjectURL(a.href), 500);
  }

  $('clearAll').addEventListener('click', ()=>{
    if (confirm('Remove all saved pages from this device?')){ localStorage.removeItem('twp.journal.v1'); renderList(); }
  });

  renderList();
})();
</script>
</body>
</html>
