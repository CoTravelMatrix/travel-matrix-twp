<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Journey Journal • Travel with Purpose</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind (CDN for MVP) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel to allow JSX in-browser (fine for prototypes) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body { font-family: Calibri, "Segoe UI", system-ui, -apple-system, Arial, sans-serif; }
    /* Matrix animations */
    .outer-ring { transform-origin: 50% 50%; animation: breathe calc(4s / var(--tau)) ease-in-out infinite alternate; }
    .petals-cw { transform-origin: 50% 50%; animation: rotate calc(15s / var(--s)) linear infinite; }
    .orbit-fast { transform-origin: 50% 50%; animation: rotate calc(8s / var(--s)) linear infinite; }
    .orbit-slow { transform-origin: 50% 50%; animation: rotate calc(12s / var(--s)) linear infinite reverse; }
    .core-pulse { transform-origin: 50% 50%; animation: pulse calc(2.5s / var(--k)) ease-in-out infinite alternate; }
    .traveller { filter: drop-shadow(0 0 calc(2px * var(--mu)) rgba(59,130,246, calc(0.4 * var(--mu)))); }
    @keyframes breathe { from { transform: scale(calc(0.95 * var(--d))); } to { transform: scale(calc(1.05 * var(--d))); } }
    @keyframes rotate { to { transform: rotate(360deg); } }
    @keyframes pulse { from { transform: scale(calc(0.9 + (var(--k) - 1) * 0.1)); } to { transform: scale(calc(1.1 + (var(--k) - 1) * 0.2)); } }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function JourneyJournalApp() {
      const [user] = useState({ id: "demo-user", email: "demo@cotravel.co.za", subscription: "premium" });
      const [currentPage, setCurrentPage] = useState("matrix");
      const [emm, setEmm] = useState({ d: 1.0, mu: 1.0, s: 1.0, tau: 1.0, k: 1.0 });
      const [journalEntries, setJournalEntries] = useState([]);
      const [currentConversation, setCurrentConversation] = useState(null);
      const [isThinking, setIsThinking] = useState(false);

      const conversationPrompts = {
        purpose: {
          title: "North Star: Purpose",
          prompt: "What quietly matters most today? Name the smallest move that honours it."
        },
        excitement: {
          title: "Fast Orbit: Excitement",
          prompt: "Where did curiosity spark? How could you keep a gentle flame without burning out?"
        },
        connection: {
          title: "Medium Orbit: Connection",
          prompt: "Who or what felt like good company? What condition helped it happen?"
        },
        reflection: {
          title: "Slow Orbit: Reflection",
          prompt: "What needs grace or fallow time? Where can you pause without quitting?"
        }
      };

      function generateTravelSuggestion(values) {
        const { d, mu, s, tau, k } = values;
        if (mu > 1.4 && tau > 1.2) {
          return { type: "Contemplative Retreat", reason: "High meaning and patience—prime for deep, interior travel." };
        } else if (d > 1.3 && s > 1.2) {
          return { type: "Adventure Expedition", reason: "Distance and speed are calling—time to cover ground." };
        } else if (k > 1.3 && mu > 1.2) {
          return { type: "Cultural Immersion", reason: "Strong intention with meaning—seek human stories, not spectacles." };
        } else {
          return { type: "Trust Your Inner Compass", reason: "Tune to the quiet signal; the map is already in you." };
        }
      }

      async function generateResponse(userMessage, type) {
        setIsThinking(true);
        await new Promise(r => setTimeout(r, 700));
        const primaryKey = Object.entries(emm).sort((a,b) => b[1]-a[1])[0][0];
        const primaryName = { d:"adventure-seeking", mu:"meaning-focused", s:"energetic", tau:"calm-centred", k:"purpose-driven" }[primaryKey];
        let text = "";
        if (type === "purpose") {
          text = `I’m sensing a ${primaryName} pattern. ${userMessage} isn’t trivial; it’s a compass bearing.
What single act today would honour that? Smaller often means truer.`;
        } else if (type === "connection") {
          text = `Connection is presence, not performance. If your meaning is rising, widen your attention and let it meet you where you already are.`;
        } else if (type === "reflection") {
          text = `Fallow time isn’t empty; it’s the soil doing quiet geometry. If patience is low, pause anyway. The pause is part of the move.`;
        } else {
          text = `Energy wants a corridor, not a cul-de-sac. Name the experience you need, then let destination follow intention.`;
        }
        setIsThinking(false);
        return text;
      }

      async function startConversation(type) {
        const msg = window.prompt(conversationPrompts[type].prompt);
        if (!msg) return;
        const convo = {
          id: Date.now(),
          messages: [
            { role: "assistant", content: conversationPrompts[type].prompt },
            { role: "user", content: msg }
          ]
        };
        const reply = await generateResponse(msg, type);
        convo.messages.push({ role: "assistant", content: reply });
        setCurrentConversation(convo);
      }

      useEffect(() => {
        const root = document.documentElement;
        Object.entries(emm).forEach(([k,v]) => root.style.setProperty(`--${k}`, String(v)));
        setJournalEntries([
          { id:1, date:"2024-06-06", title:"Athens Arrival", content:"Shadow of the Acropolis. Gratitude. Breath slow, eyes wide.", tags:["grateful","curious","inspired"], location:"Athens", emm:{ d:1.2, mu:1.4, s:0.9, tau:1.1, k:1.3 } },
          { id:2, date:"2024-06-07", title:"Ancient Wisdom", content:"Agora at sunrise. Silence teaches more than plaques.", tags:["peaceful","contemplative","connected"], location:"Agora", emm:{ d:0.9, mu:1.7, s:0.7, tau:1.5, k:1.4 } }
        ]);
      }, [emm]);

      const fmt = x => Number(x).toFixed(2);
      const suggestion = generateTravelSuggestion(emm);

      return (
        <div>
          {/* Header */}
          <header className="bg-white shadow-sm border-b">
            <div className="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
              <div>
                <h1 className="text-2xl font-bold text-gray-900">Journey Journal</h1>
                <p className="text-gray-600">Travel with Purpose • Your inner landscape as living art</p>
              </div>
              <div className="flex items-center gap-4">
                <span className="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium">Premium</span>
                <div className="text-right">
                  <div className="text-sm font-medium text-gray-900">{user.email}</div>
                  <div className="text-xs text-gray-500">CoTravel Member</div>
                </div>
              </div>
            </div>
          </header>

          {/* Nav */}
          <nav className="bg-white border-b">
            <div className="max-w-7xl mx-auto px-6">
              <div className="flex space-x-8">
                {[
                  { id: "matrix", label: "Living Matrix" },
                  { id: "conversation", label: "Paula Chat" },
                  { id: "journal", label: "Journal Entries" }
                ].map(tab => (
                  <button key={tab.id}
                    onClick={() => setCurrentPage(tab.id)}
                    className={`py-4 px-2 border-b-2 font-medium text-sm ${
                      currentPage === tab.id ? "border-blue-500 text-blue-600" :
                      "border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`}>
                    {tab.label}
                  </button>
                ))}
              </div>
            </div>
          </nav>

          {/* Main */}
          <main className="max-w-7xl mx-auto px-6 py-8">
            {currentPage === "matrix" && (
              <div className="bg-white rounded-2xl shadow-lg p-6">
                <h2 className="text-2xl font-semibold text-gray-900 mb-6">Your Living Matrix</h2>
                <div className="mb-6">
                  <svg viewBox="0 0 400 400" className="w-full h-auto"
                       style={{ ["--d"]:emm.d, ["--mu"]:emm.mu, ["--s"]:emm.s, ["--tau"]:emm.tau, ["--k"]:emm.k }}>
                    <rect width="400" height="400" fill="#f8fafc" />
                    <g className="outer-ring"><circle cx="200" cy="200" r="180" fill="none" stroke="#3b82f6" strokeWidth="2" opacity="0.8"/></g>
                    <g className="petals-cw" opacity="0.6">
                      {[0,60,120].map(a => (
                        <g key={a} transform={`rotate(${a} 200 200)`}>
                          <circle cx="200" cy="200" r="120" fill="none" stroke="#6b7280" strokeWidth="1.5"/>
                        </g>
                      ))}
                    </g>
                    <g className="orbit-fast">
                      <ellipse cx="200" cy="200" rx="160" ry="100" fill="none" stroke="#111" strokeWidth="2.5" opacity="0.9"/>
                      <circle cx="360" cy="200" r="6" fill="#111" className="traveller"/>
                    </g>
                    <g className="orbit-slow">
                      <ellipse cx="200" cy="200" rx="80" ry="140" fill="none" stroke="#666" strokeWidth="2"/>
                      <circle cx="280" cy="200" r="5" fill="#666" className="traveller"/>
                    </g>
                    <g className="core-pulse">
                      <circle cx="200" cy="200" r="30" fill="#1f2937" opacity="0.85"/>
                      <circle cx="200" cy="200" r="45" fill="none" stroke="#3b82f6" strokeWidth="2" opacity="0.9"/>
                    </g>
                  </svg>
                </div>

                <div className="grid grid-cols-5 gap-4 mb-6">
                  {Object.entries(emm).map(([key, value]) => (
                    <div key={key} className="text-center">
                      <div className="text-2xl font-mono font-bold text-blue-600 mb-2">{fmt(value)}</div>
                      <div className="text-xs text-gray-500 mb-2">
                        {key==="mu"?"μ (meaning)":key==="tau"?"τ (patience)":key==="d"?"d (distance)":key==="s"?"s (speed)":"k (intention)"}
                      </div>
                      <input type="range"
                        min={key==="d"?0.7:key==="mu"||key==="s"?0.5:key==="tau"?0.6:0.8}
                        max={key==="d"||key==="tau"||key==="k"?1.6:2.0}
                        step="0.01" value={value}
                        onChange={e => setEmm({ ...emm, [key]: parseFloat(e.target.value) })}
                        className="w-full" />
                    </div>
                  ))}
                </div>

                <div className="bg-blue-50 rounded-lg p-4">
                  <h3 className="font-semibold text-blue-900 mb-2">Current Suggestion</h3>
                  <p className="text-blue-800">{suggestion.reason}</p>
                </div>
              </div>
            )}

            {currentPage === "conversation" && (
              <div className="bg-white rounded-2xl shadow-lg p-6">
                <h2 className="text-2xl font-semibold text-gray-900 mb-6">Conversation with Paula</h2>
                {!currentConversation ? (
                  <div className="space-y-4">
                    <p className="text-gray-600 mb-6">Choose a conversation starter inspired by your Travel with Purpose journey:</p>
                    {Object.entries(conversationPrompts).map(([key, p]) => (
                      <button key={key}
                        onClick={() => startConversation(key)}
                        className="w-full text-left p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-colors">
                        <h3 className="font-semibold text-gray-900 mb-2">{p.title}</h3>
                        <p className="text-gray-600 text-sm">{p.prompt}</p>
                      </button>
                    ))}
                  </div>
                ) : (
                  <div className="space-y-4">
                    <button onClick={() => setCurrentConversation(null)} className="text-blue-600 hover:text-blue-800 mb-4">← Start New Conversation</button>
                    {currentConversation.messages.map((m,i) => (
                      <div key={i} className={`p-4 rounded-lg ${m.role==="assistant"?"bg-blue-50 border-l-4 border-blue-400":"bg-gray-50 border-l-4 border-gray-400"}`}>
                        <div className="text-sm text-gray-500 mb-2">{m.role==="assistant"?"Paula":"You"}</div>
                        <div className="text-gray-800 whitespace-pre-wrap">{m.content}</div>
                      </div>
                    ))}
                    {isThinking && (
                      <div className="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400">
                        <div className="text-sm text-blue-600 mb-2">Paula is reflecting…</div>
                        <div className="text-blue-800">Thinking about your journey…</div>
                      </div>
                    )}
                  </div>
                )}
              </div>
            )}

            {currentPage === "journal" && (
              <div className="bg-white rounded-2xl shadow-lg p-6">
                <h2 className="text-2xl font-semibold text-gray-900 mb-6">Journey Journal</h2>
                <div className="space-y-6">
                  {journalEntries.map(entry => (
                    <div key={entry.id} className="border border-gray-200 rounded-lg p-4">
                      <div className="flex justify-between items-start mb-3">
                        <h3 className="text-lg font-semibold text-gray-900">{entry.title}</h3>
                        <span className="text-sm text-gray-500">{entry.date}</span>
                      </div>
                      <p className="text-gray-700 mb-3">{entry.content}</p>
                      <div className="flex flex-wrap gap-2 mb-3">
                        {entry.tags.map((t,i) => <span key={i} className="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">{t}</span>)}
                      </div>
                      <div className="text-sm text-gray-500">Location: {entry.location}</div>
                      <div className="grid grid-cols-5 gap-2 mt-3 text-center">
                        {Object.entries(entry.emm).map(([k,v]) => (
                          <div key={k} className="text-xs">
                            <div className="font-mono text-blue-600">{fmt(v)}</div>
                            <div className="text-gray-500">{k}</div>
                          </div>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </main>

          {/* Footer */}
          <footer className="bg-white border-t mt-16">
            <div className="max-w-7xl mx-auto px-6 py-8 text-center">
              <h3 className="text-lg font-semibold text-gray-900 mb-2">Travel with Purpose</h3>
              <p className="text-gray-600 mb-4">Transform your inner journey into living art and meaningful travel experiences</p>
              <div className="mt-4 text-xs text-gray-500">© 2025 CoTravel • Journey Journal • Travel with Purpose</div>
            </div>
          </footer>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<JourneyJournalApp />);
  </script>
</body>
</html>

